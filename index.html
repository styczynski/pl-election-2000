<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <link href="https://fonts.googleapis.com/css?family=PT+Sans|Raleway:800" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="./index.css">
        <script
                src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
                integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
                crossorigin="anonymous"></script>
        <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.7.2/d3.min.js"></script>
        <script src="./vendor/d3pie.min.js"></script>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <!--<script src="http://d3js.org/d3.v3.js"></script>-->
        <script src="./vendor/pl-map.js"></script>
        <title>Wybory Prezydenta Rzeczypospolitej Polskiej 2000</title>
    </head>
    <body>

    <header>
        <div class="title">
            <a href="http://prezydent2000.pkw.gov.pl/index.html">
                <!--
                  <img src="./img/l.gif" width="337" height="87" border="0">
                  <img src="./img/n5.gif">
                -->
                Wybory Prezydenta
                <br>
                Rzeczypospolitej Polskiej 2000r.
            </a>
            <div class="mask">
                <img src="./img/voting_flag.png"/>
            </div>
        </div>
    </header>

    <img class="background-image" src="./img/voting_image.png"/>

        <nav class="sections">
            <ul>

            </ul>
        </nav>


        <nav class="links">
            <ul>
                <li>
                    <a href="http://prezydent2000.pkw.gov.pl/so/so.html">Wyniki głosowania - statystyki ogólne</a>
                </li>
                <li>
                    <a href="http://prezydent2000.pkw.gov.pl/zw/wb_zw.html">Wyniki głosowania - zwycięski kandydat</a>
                </li>
                <li>
                    <a href="http://prezydent2000.pkw.gov.pl/wb/wb_wgobwodu.html">Wyniki głosowania według rodzaju obwodu</a>
                </li>
                <li>
                    <a href="http://prezydent2000.pkw.gov.pl/wb/wb_wgzam.html">Wyniki głosowania w miełcie i na wsi</a>
                </li>
                <li>
                    <a href="http://prezydent2000.pkw.gov.pl/wb/wb_zagranica.html">Wyniki głosowania za granicą</a>
                </li>
            </ul>
        </nav>

        <div class="content-view"></div>

        <main>

            <ol style="display:none">
                <li>
                    <a href="http://www.example.com/">
                        Polska
                    </a>
                </li>
            </ol>


            <section>
                <h2>Procentowa liczba głosów dla poszczególnych kandydatów</h2>
                <span class="section-icon" data-icon="fas fa-users"></span>

                <figure>
                    <!--<img src="./img/kd.png" border="0">-->
                    <div id="votes-per-cand-chart"></div>
                </figure>
            </section>

            <br>

            <section>
                <h2>Wyniki poszczególnych kandydatów</h2>
                <span class="section-icon" data-icon="fas fa-info"></span>
            </section>

            <br>

            <section>
                <h2>Frekwencja</h2>
                <span class="section-icon" data-icon="fas fa-percent"></span>
                <figure>
                    <!--<img src="./img/pwf.gif" border="0"><img src="./img/31.png" alt="Legenda" border="0">-->
                    <!--<svg id="frequency-map-chart" width="500px" height="500px">
                        <g class="map"></g>
                    </svg>-->
                    <div id="frequency-map-chart"></div>
                </figure>

                <table width="100%" cellspacing="2" cellpadding="1" border="0">
                    <tbody>
                        <tr>
                            <td width="100%">
                                <table border="0" width="100%">
                                    <tbody>
                                        <tr>
                                            <td valign="top" width="33%"><a href="http://prezydent2000.pkw.gov.pl/wb/woj/020000.html">WOJ. DOLNOŚLĄSKIE</a><br><a href="http://prezydent2000.pkw.gov.pl/wb/woj/040000.html">WOJ. KUJAWSKO-POMORSKIE</a><br><a href="http://prezydent2000.pkw.gov.pl/wb/woj/060000.html">WOJ. LUBELSKIE</a><br><a href="http://prezydent2000.pkw.gov.pl/wb/woj/080000.html">WOJ. LUBUSKIE</a><br><a href="http://prezydent2000.pkw.gov.pl/wb/woj/100000.html">WOJ. ŁÓDZKIE</a><br></td>
                                            <td valign="top" width="33%"><a href="http://prezydent2000.pkw.gov.pl/wb/woj/120000.html">WOJ. MAŁOPOLSKIE</a><br><a href="http://prezydent2000.pkw.gov.pl/wb/woj/140000.html">WOJ. MAZOWIECKIE</a><br><a href="http://prezydent2000.pkw.gov.pl/wb/woj/160000.html">WOJ. OPOLSKIE</a><br><a href="http://prezydent2000.pkw.gov.pl/wb/woj/180000.html">WOJ. PODKARPACKIE</a><br><a href="http://prezydent2000.pkw.gov.pl/wb/woj/200000.html">WOJ. PODLASKIE</a><br></td>
                                            <td valign="top" width="33%"><a href="http://prezydent2000.pkw.gov.pl/wb/woj/220000.html">WOJ. POMORSKIE</a><br><a href="http://prezydent2000.pkw.gov.pl/wb/woj/240000.html">WOJ. ŚLĄSKIE</a><br><a href="http://prezydent2000.pkw.gov.pl/wb/woj/260000.html">WOJ. ŚWIĘTOKRZYSKIE</a><br><a href="http://prezydent2000.pkw.gov.pl/wb/woj/280000.html">WOJ. WARMIŃSKO-MAZURSKIE</a><br><a href="http://prezydent2000.pkw.gov.pl/wb/woj/300000.html">WOJ. WIELKOPOLSKIE</a><br><a href="http://prezydent2000.pkw.gov.pl/wb/woj/320000.html">WOJ. ZACHODNIOPOMORSKIE</a><br></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section>
                <h2>Statystyka ogółem</h2>
                <table width="100%" border="0" cellspacing="2" cellpadding="1" align="center">

                </table>
            </section>

            <br>
            <footer>
                <table width="100%" cellpadding="0" cellspacing="0" border="0">
                    <tbody>
                        <tr>
                            <td colspan="2" align="center">
                                Vector Art by <a href="https://www.vecteezy.com/">Vecteezy</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </footer>
        </main>

        <script>

            var VOTES_PER_CANDIDATE = [
                {
                    "name": "Pawłowski Bogdan",
                    "votes": 0.10
                },
                {
                    "name": "Wilecki Tadeusz",
                    "votes": 0.16
                },
                {
                    "name": "Ikonowicz Piotr",
                    "votes": 0.22
                },
                {
                    "name": "Grabowski Dariusz",
                    "votes": 0.51
                },
                {
                    "name": "Łopuszański Jan",
                    "votes": 0.79
                },
                {
                    "name": "Wałęsa Lech",
                    "votes": 1.01
                },
                {
                    "name": "Korwin-Mikke Janusz",
                    "votes": 1.43
                },
                {
                    "name": "Lepper Andrzej",
                    "votes": 3.05
                },
                {
                    "name": "Kalinowski Jarosław",
                    "votes": 5.95
                },
                {
                    "name": "Krzaklewski Marian",
                    "votes": 15.57
                },
                {
                    "name": "Olechowski Andrzej",
                    "votes": 17.30
                },
                {
                    "name": "Kwaśniewski Aleksander",
                    "votes": 53.90
                }
            ];

            var PIE_COLORS = [
                "#944a4a",
                "#6e5454",
                "#c79191",
                "#cecccc",
                "#ba8b8b",
                "#975259",
                "#c6b6b6",
                "#a15656",
                "#a8928a",
                "#754a4a",
                "#c5afaf"
            ];

            $(document).ready(function() {
                function ContentsView() {
                    var self = this;
                    var sectionsNavList = $(".sections > ul");
                    self.displayedIndex = 0;
                    self.sections = [];
                    self.switchTo = function changeContentView(index) {
                        console.log("! Switch to "+index)
                        self.displayedIndex = index;
                        $(".content-view").children().appendTo("main");
                        $($("main section.section-"+index)).appendTo($(".content-view"));
                    };
                    self.init = function() {
                        self.__createChart();
                        //self.__createMap();
                        self.__createGeoMap();
                        $("main section > .section-icon").each(function(index){
                           var el = $(this);
                           var section = el.parent();
                           section.addClass("section-"+index);
                           var sectionName = section.find("h2").text();
                           var clickableIcon = ($("" +
                               "<li>\n" +
                               "   <h1>\n" +
                               "      <i class=\""+el.data("icon")+"\"></i>\n" +
                               "   </h1>\n" +
                               "</li>"
                           ));
                           clickableIcon.click(function(){
                               self.switchTo(index);
                           });
                           sectionsNavList.append(clickableIcon);
                           self.sections.push({
                               name: sectionName,
                               element: section
                           });
                        });
                        self.switchTo(self.displayedIndex);
                    };
                    self.__createGeoMap = function() {
                            google.charts.load('current', {
                              'packages':['geochart'],
                              // Note: you will need to get a mapsApiKey for your project.
                              // See: https://developers.google.com/chart/interactive/docs/basic_load_libs#load-settings
                              'mapsApiKey': 'AIzaSyD-9tSrke72PouQMnMX-a7eZSW0jkFMBWY'
                            });


                            function drawRegionsMap() {
                              var data = google.visualization.arrayToDataTable([
                                ['Country', 'Popularity'],
                                ['Germany', 200],
                                ['United States', 300],
                                ['Brazil', 400],
                                ['Canada', 500],
                                ['France', 600],
                                ['RU', 700]
                              ]);

                              var options = {
                                region: 'PL',
                                backgroundColor: 'transparent',
                                height: 500,
                                width: 500
                              };

                              var chart = new google.visualization.GeoChart(document.getElementById('frequency-map-chart'));

                              chart.draw(data, options);
                            }
                            google.charts.setOnLoadCallback(drawRegionsMap);

                    };


                    self.__createMap = function() {

                        var geojson = window.PlGeoMap;

                        /*var context = d3.select('#frequency-map-chart')
                            .node()
                            .getContext('2d');

                        var projection = d3.geoEquirectangular();

                        var geoGenerator = d3.geoPath()
                            .projection(projection)
                            .context(context);

                        projection.fitExtent([[0, -100], [400, 400]], geojson);
                        //projection.translate([0, 0]);

                        context.lineWidth = 0.5;
                        context.strokeStyle = '#888';

                        context.beginPath();
                        geoGenerator({type: 'FeatureCollection', features: geojson.features})
                        context.stroke();*/

                        //var projection = d3.geoMercator()
                        //    .scale(400)
                        //    .translate([200, 280])
                        //    .center([0, 5]);

                        var projection = d3.geoEquirectangular();

                        projection.fitExtent([[0, -100], [400, 400]], geojson);

                        var geoGenerator = d3.geoPath()
                            .projection(projection);

                        function handleMouseover(d) {

                            var pixelArea = geoGenerator.area(d);
                            var bounds = geoGenerator.bounds(d);
                            var centroid = geoGenerator.centroid(d);
                            var measure = geoGenerator.measure(d);

                            //d3.select('#frequency-map-chart .info')
                            //    .text(d.properties.name + ' (path.area = ' + pixelArea.toFixed(1) + ' path.measure = ' + measure.toFixed(1) + ')');

                        }


                        var u = d3.select('#frequency-map-chart g.map')
                            .selectAll('path')
                            .data(geojson.features);

                        u.enter()
                            .append('path')
                            .attr('d', geoGenerator)
                            .on('mouseover', handleMouseover);


                        $("#frequency-map-chart path").each(function() {
                            var pathEl = $(this);
                            pathEl.css('fill', 'rgb(151, 82, 89)');
                            //pathEl.css('stroke-width', '1px');
                            //pathEl.css('stroke', 'black');
                        });
                    };
                    self.__createChart = function() {


                        var pieVotesConfigArray = [];
                        VOTES_PER_CANDIDATE.forEach(function(el, index){
                            pieVotesConfigArray.push({
                                label: el.name,
                                value: el.votes,
                                color: PIE_COLORS[index % PIE_COLORS.length]
                            });
                        });

                        var pie = new d3pie("votes-per-cand-chart", {
                            "header": {
                                "title": {
                                    "text": "Wyniki wyobrów 2000r.",
                                    "fontSize": 16,
                                    "font": "open sans"
                                },
                                "subtitle": {
                                    "text": "",
                                    "color": "#999999",
                                    "fontSize": 12,
                                    "font": "open sans"
                                },
                                "titleSubtitlePadding": 9
                            },
                            "footer": {
                                "color": "#999999",
                                "fontSize": 10,
                                "font": "open sans",
                                "location": "bottom-left"
                            },
                            "size": {
                                "canvasWidth": 790,
                                "pieInnerRadius": "48%",
                                "pieOuterRadius": "90%"
                            },
                            "data": {
                                "sortOrder": "value-desc",
                                "content": pieVotesConfigArray
                            },
                            "labels": {
                                "outer": {
                                    "pieDistance": 32
                                },
                                "inner": {
                                    "hideWhenLessThanPercentage": 3
                                },
                                "mainLabel": {
                                    "fontSize": 11
                                },
                                "percentage": {
                                    "color": "#ffffff",
                                    "decimalPlaces": 0
                                },
                                "value": {
                                    "color": "#adadad",
                                    "fontSize": 11
                                },
                                "lines": {
                                    "enabled": true
                                },
                                "truncation": {
                                    "enabled": true
                                }
                            },
                            "effects": {
                                "pullOutSegmentOnClick": {
                                    "effect": "linear",
                                    "speed": 400,
                                    "size": 8
                                }
                            },
                            "misc": {
                                "gradient": {
                                    "enabled": true,
                                    "percentage": 100
                                }
                            }
                        });
                    };
                    return self;
                }
                var view = new ContentsView();
                view.init();
                window.contentsView = view;
            })
        </script>

    </body>
</html>
